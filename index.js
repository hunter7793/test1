(()=>{"use strict";class t{constructor(t,e){this.target=t.target,this.event=t,this.svg=e;let r={cursorStartPositionX:void 0,cursorStartPositionY:void 0,object:void 0,target:document,mouse:void 0,zPos:void 0,movingSpeed:1,shift:void 0},i=t=>{"Shift"==t.key&&(r.shift=!1,r.movingSpeed=1)},s=t=>{let e=t.x-r.cursorStartPositionX,i=t.y-r.cursorStartPositionY;if("rect"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("x")),r=parseInt(this.target.getAttribute("y"));t+=e,r+=i,t+="px",r+="px",this.target.setAttribute("x",t),this.target.setAttribute("y",r)}if("circle"==this.event.target.nodeName||"ellipse"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("cx")),r=parseInt(this.target.getAttribute("cy"));t+=e,r+=i,t+="px",r+="px",this.target.setAttribute("cx",t),this.target.setAttribute("cy",r)}if("line"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("x1")),r=parseInt(this.target.getAttribute("y1")),s=parseInt(this.target.getAttribute("x2")),n=parseInt(this.target.getAttribute("y2"));t+=e,r+=i,s+=e,n+=i,t+="px",r+="px",s+="px",n+="px",this.target.setAttribute("x1",t),this.target.setAttribute("y1",r),this.target.setAttribute("x2",s),this.target.setAttribute("y2",n)}if("polygon"==this.event.target.nodeName||"polyline"==this.event.target.nodeName){let t=this.target.getAttribute("points").split(" "),r="",s="";t.forEach((function(n,a){let o=t[a].split(",");o[0]=parseInt(o[0])+e,o[1]=parseInt(o[1])+i,r+=s+o[0]+","+o[1],s=" "})),this.target.setAttribute("points",r)}r.cursorStartPositionX=t.x,r.cursorStartPositionY=t.y},n=t=>{if(r.shift||"Shift"!=t.key||(r.shift=!0,r.movingSpeed=15),"ArrowDown"==t.key){if(t.preventDefault(),"rect"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("y"));t+=r.movingSpeed,t+="px",this.target.setAttribute("y",t)}if("circle"==this.event.target.nodeName||"ellipse"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("cy"));t+=r.movingSpeed,t+="px",this.target.setAttribute("cy",t)}if("line"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("y1")),e=parseInt(this.target.getAttribute("y2"));t+=r.movingSpeed,e+=r.movingSpeed,t+="px",e+="px",this.target.setAttribute("y1",t),this.target.setAttribute("y2",e)}if("polygon"==this.event.target.nodeName||"polyline"==this.event.target.nodeName){let t=this.target.getAttribute("points").split(" "),e="",i="";t.forEach((function(s,n){let a=t[n].split(",");a[1]=parseInt(a[1])+r.movingSpeed,e+=i+parseInt(a[0])+","+a[1],i=" "})),this.target.setAttribute("points",e)}}if("ArrowUp"==t.key){if(t.preventDefault(),"rect"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("y"));t-=r.movingSpeed,t+="xp",this.target.setAttribute("y",t)}if("circle"==this.event.target.nodeName||"ellipse"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("cy"));t-=r.movingSpeed,t+="px",this.target.setAttribute("cy",t)}if("line"==this.event.target.nodeName){let t=parseInt(this.target.getAttribute("y1")),e=parseInt(this.target.getAttribute("y2"));t-=r.movingSpeed,e-=r.movingSpeed,t+="px",e+="px",this.target.setAttribute("y1",t),this.target.setAttribute("y2",e)}if("polygon"==this.event.target.nodeName||"polyline"==this.event.target.nodeName){let t=this.target.getAttribute("points").split(" "),e="",i="";t.forEach((function(s,n){let a=t[n].split(",");a[1]=parseInt(a[1])-r.movingSpeed,e+=i+parseInt(a[0])+","+parseInt(a[1]),i=" "})),this.target.setAttribute("points",e)}}if("ArrowRight"==t.key){if(t.preventDefault(),"rect"==this.event.target.nodeName){let t=+this.target.getAttribute("x");t+=r.movingSpeed,t+="",this.target.setAttribute("x",t)}if("circle"==this.event.target.nodeName||"ellipse"==this.event.target.nodeName){let t=+this.target.getAttribute("cx");t+=r.movingSpeed,t+="",this.target.setAttribute("cx",t)}if("line"==this.event.target.nodeName){let t=+this.target.getAttribute("x1"),e=+this.target.getAttribute("x2");t+=r.movingSpeed,e+=r.movingSpeed,t+="",e+="",this.target.setAttribute("x1",t),this.target.setAttribute("x2",e)}if("polygon"==this.event.target.nodeName||"polyline"==this.event.target.nodeName){let t=this.target.getAttribute("points").split(" "),e="",i="";t.forEach((function(s,n){let a=t[n].split(",");a[0]=+a[0]+r.movingSpeed,e+=i+a[0]+","+a[1],i=" "})),this.target.setAttribute("points",e)}}if("ArrowLeft"==t.key){if(t.preventDefault(),"rect"==this.event.target.nodeName){let t=+this.target.getAttribute("x");t-=r.movingSpeed,t+="",this.target.setAttribute("x",t)}if("circle"==this.event.target.nodeName||"ellipse"==this.event.target.nodeName){let t=+this.target.getAttribute("cx");t-=r.movingSpeed,t+="",this.target.setAttribute("cx",t)}if("line"==this.event.target.nodeName){let t=+this.target.getAttribute("x1"),e=+this.target.getAttribute("x2");t-=r.movingSpeed,e-=r.movingSpeed,t+="",e+="",this.target.setAttribute("x1",t),this.target.setAttribute("x2",e)}if("polygon"==this.event.target.nodeName||"polyline"==this.event.target.nodeName){let t=this.target.getAttribute("points").split(" "),e="",i="";t.forEach((function(s,n){let a=t[n].split(",");a[0]=+a[0]-r.movingSpeed,e+=i+a[0]+","+a[1],i=" "})),this.target.setAttribute("points",e)}}},a=()=>{r.mouse=!1,r.target.removeEventListener("mousemove",s),r.target.removeEventListener("mouseup",a)},o=()=>{r.cursorStartPositionX=this.event.x,r.cursorStartPositionY=this.event.y,this.target.style.outline="solid 3px rgb(255,0,0,0.2)",r.mouse=!0,r.target.addEventListener("mousemove",s),r.target.addEventListener("mouseup",a),r.target.addEventListener("keydown",n),r.target.addEventListener("keyup",i)},g=t=>{if(r.shift||"Shift"!=t.key||(r.shift=!0,r.movingSpeed=15),"ArrowDown"==t.key){t.preventDefault();let e=0,i=getComputedStyle(this.target.parentNode),s=getComputedStyle(this.target);e=parseInt(s.top)+r.movingSpeed>=parseInt(i.height)-parseInt(s.height)?parseInt(i.height)-parseInt(s.height):parseInt(s.top)+r.movingSpeed,e+="px",this.target.style.top=e}if("ArrowUp"==t.key){t.preventDefault();let e=0,i=getComputedStyle(this.target);e=parseInt(i.top)-r.movingSpeed<=0?0:parseInt(i.top)-r.movingSpeed,e+="px",this.target.style.top=e}if("ArrowRight"==t.key){t.preventDefault();let e=0,i=getComputedStyle(this.target.parentNode),s=getComputedStyle(this.target);e=parseInt(s.left)+r.movingSpeed>=parseInt(i.width)-parseInt(s.width)?parseInt(i.width)-parseInt(s.width):parseInt(s.left)+r.movingSpeed,e+="px",this.target.style.left=e}if("ArrowLeft"==t.key){t.preventDefault();let e=0,i=getComputedStyle(this.target);e=parseInt(i.left)-r.movingSpeed<=0?0:parseInt(i.left)-r.movingSpeed,e+="px",this.target.style.left=e}},p=t=>{let e=t.x-r.cursorStartPositionX,i=t.y-r.cursorStartPositionY,s=getComputedStyle(this.target).left,n=getComputedStyle(this.target).top,a=this.target.offsetLeft,o=this.target.offsetTop;switch((isNaN(s)||isNaN(n))&&(s=this.target.offsetLeft,n=this.target.offsetTop),s=parseInt(s),n=parseInt(n),a=parseInt(a),o=parseInt(o),s+=e,n+=i,s<0&&(s=0),n<0&&(n=0),s>parseInt(r.parent.width)-parseInt(getComputedStyle(this.target).width)&&(s=parseInt(r.parent.width)-parseInt(getComputedStyle(this.target).width)),n>parseInt(r.parent.height)-parseInt(getComputedStyle(this.target).height)&&(n=parseInt(r.parent.height)-parseInt(getComputedStyle(this.target).height)),!0){case t.x<=r.parentLeft:case t.y<=r.parentTop:case t.x>=r.parentRight:case t.y>=r.parentBottom:u()}s+="px",n+="px",this.target.style.left=s,this.target.style.top=n,r.cursorStartPositionX=t.x,r.cursorStartPositionY=t.y},h=()=>{r.target.addEventListener("mousemove",p),this.target.addEventListener("mouseup",u)},u=()=>{r.mouse=!1,r.target.removeEventListener("mousemove",p),this.target.removeEventListener("mouseup",u)};r.zPos=getComputedStyle(this.target).zIndex,r.transit=getComputedStyle(this.target).transition.split(" ")[1],(t=>{r.cursorStartPositionX=this.event.x,r.cursorStartPositionY=this.event.y,this.target.style.transition="0s",this.svg?o():(this.target.style.zIndex=100,this.target.style.outline="solid 3px rgb(255,0,0,0.2)",r.mouse=!0,r.parent=getComputedStyle(this.target.parentNode),r.parentLeft=parseInt(r.parent.left),r.parentRight=parseInt(r.parent.left)+parseInt(r.parent.width),r.parentTop=parseInt(r.parent.top),r.parentBottom=parseInt(r.parent.top)+parseInt(r.parent.height),r.target.addEventListener("keydown",g),r.target.addEventListener("keyup",i),h())})(this.target,this.event),this.end=()=>{this.svg?(this.target.style.outline="",r.target.removeEventListener("keydown",n),r.target.removeEventListener("mousemove",s),r.target.removeEventListener("mouseup",a),r.target.removeEventListener("keyup",i)):(this.target.style.zIndex=r.zPos,this.target.style.outline="",this.target.style.transition=r.transit,u(),r.target.removeEventListener("keydown",g),r.target.removeEventListener("keyup",i))}}}const e=document.getElementById("choose");let r,i=[],s=document.querySelector(".svg"),n={rect:document.createElementNS("http://www.w3.org/2000/svg","rect"),cnt:0};function a(){function t(t){let e,r,i;if(e=(t[2]-t[0])*(t[7]-t[5])-(t[6]-t[4])*(t[3]-t[1]),0!=e)return r=((t[7]-t[5])*(t[6]-t[0])+(t[4]-t[6])*(t[7]-t[1]))/e,i=((t[1]-t[3])*(t[6]-t[0])+(t[2]-t[0])*(t[7]-t[1]))/e,0<r&&r<=1&&0<i&&i<=1?(n.cnt++,!0):void 0}n.x=parseInt(n.rect.getAttribute("x")),n.y=parseInt(n.rect.getAttribute("y")),n.x1=n.x+parseInt(n.rect.getAttribute("width")),n.y1=n.y+parseInt(n.rect.getAttribute("height")),n.cnt=0,i.forEach((function(e,r){let i=parseInt(e.getAttribute("x1")),s=parseInt(e.getAttribute("x2")),a=parseInt(e.getAttribute("y1")),o=parseInt(e.getAttribute("y2"));switch(!0){case n.x<=i&&n.x1>=i&&n.y1>=a&&n.y<=a:e.setAttribute("stroke","red"),n.cnt++;break;case t([i,a,s,o,n.x,n.y,n.x1,n.y]):case t([i,a,s,o,n.x,n.y,n.x,n.y1]):case t([i,a,s,o,n.x1,n.y,n.x1,n.y1]):case t([i,a,s,o,n.x,n.y1,n.x1,n.y1]):e.setAttribute("stroke","red");break;default:e.setAttribute("stroke","black")}})),document.getElementById("cnt").textContent=n.cnt}n.rect.setAttribute("x","15"),n.rect.setAttribute("y","34"),n.rect.setAttribute("width","240"),n.rect.setAttribute("height","170"),n.rect.setAttribute("stroke","black"),n.rect.setAttribute("stroke-width","2"),n.rect.setAttribute("stroke-dasharray","5,5"),n.rect.setAttribute("fill","transparent"),n.rect.classList.add(".movable"),n.rect.onmouseenter=()=>{n.rect.style.cursor="grab"},e.onchange=()=>{!function(t,e){if(!t[0])return console.log("nothing to upload.");const r=new FileReader;r.onload=t=>{let e=t.currentTarget.result.split("\r\n");e.length>1&&function(t){let e=document.createElementNS("http://www.w3.org/2000/svg","line");s.textContent="",e.setAttribute("stroke","blue"),e.setAttribute("stroke-width","2"),t.forEach((function(t,r){if(t){let r=t.split(";");r=[...r[0].split(","),...r[1].split(",")],4==r.length&&(r.find(((t,e)=>{if(isNaN(t))return e}))||(e.setAttribute("x1",r[0]),e.setAttribute("y1",r[1]),e.setAttribute("x2",r[2]),e.setAttribute("y2",r[3]),s.appendChild(e.cloneNode(!0))))}})),s.appendChild(n.rect),i=document.querySelectorAll("line"),document.getElementById("all").textContent=i.length,a()}(e)},r.readAsText(t[0])}(e.files)},document.addEventListener("mousedown",(e=>{e.target.classList.contains(".movable")&&(r=new t(e,!0),n.rect.style.cursor="grabbing")})),document.addEventListener("mouseup",(t=>{r&&(r.end(),r=void 0,n.rect.style.cursor="grab",a())}))})();